<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Heart Disease Predictor</title>
    <style type="text/css">
    body {background-color: lightyellow}
    </style>
  </head>

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>

<div style="width:100%;"> <!-- Main Div -->
<center>
<h1 style="color: maroon">Heart Disease Predictor</h1>
</center>
<div style="float:left; width:50%;">

<p>
  <label for="nSex" 
         style="display: inline-block; width: 350px; text-align: right">
         Sex (0=female,1=male) = <span id="nSex-value">0</span>
  </label>
  <input type="range" min="0" max="1" step="1" id="nSex" value="0">
</p>

<p>
  <label for="nRestbp" 
         style="display: inline-block; width: 350px; text-align: right">
         Resting Blood Pressure (mm Hg) = <span id="nRestbp-value">80</span>
  </label>
  <input type="range" min="94" max="200" step="all" id="nRestbp" value="80">
</p>

<p>
  <label for="nThalach" 
         style="display: inline-block; width: 350px; text-align: right">
         Thalium Stress Test Max. HR = <span id="nThalach-value">100</span>
  </label>
  <input type="range" min="71" max="202" step="all" id="nThalach" value="100">
</p>

<p>
  <label for="nCa" 
         style="display: inline-block; width: 350px; text-align: right">
         Number of Major Vessels Colored by Fluoroscopy = <span id="nCa-value">0</span>
  </label>
  <input type="range" min="0" max="3" step="all" id="nCa" value="0">
</p>

<p>
  <label for="nCp" 
         style="display: inline-block; width: 350px; text-align: right">
         Chest Pain Type (1=typical angina, 2=atypical angina, 3=non-angina, 4=asymptomatic angina) = <span id="nCp-value">0</span>
  </label>
  <input type="range" min="1" max="4" step="1" id="nCp" value="0">
</p>

<p>
  <label for="nSlope" 
         style="display: inline-block; width: 350px; text-align: right">
         Peak Exercise ST Segment (0=flat or downsloping, 1=upsloping) = <span id="nSlope-value">0</span>
  </label>
  <input type="range" min="0" max="1" step="1" id="nSlope" value="0">
</p>

<p>
  <label for="nThal" 
         style="display: inline-block; width: 350px; text-align: right">
         Thalium Test: (0=normal or fixed defect, 1=reversible defect) = <span id="nThal-value">0</span>
  </label>
  <input type="range" min="0" max="1" step="1" id="nThal" value="0">
</p>

</div>

<div style="float:left; width:50%; margin-left:10px;">

<script>

var width  = 100;
var height = 400;
 
var holder = d3.select("body")
      .append("svg")
      .attr("width", width)    
      .attr("height", height); 

// draw a rectangle
var y0 = 20;
var height0 = 380;
holder.append("rect")
    .attr("x", 5)
    .attr("y", y0+height0)
    .style("fill", "lightgreen")
    .attr("height", 0) 
    .attr("width", 90);

// draw a container rectangle
holder.append("rect")
	.attr("x", 5)
	.attr("y", y0)
	.style("fill", "none")
	.style("stroke", "lightblue")
	.style("stroke-width",4)
	.attr("height",height0)
	.attr("width",90);

// add text inside rectangle
holder.append("text")
	.text("0.00%")
	.attr("x",12)
	.attr("y",y0+height0-10)
	.attr("fill","black")
  .attr("font-family","Verdana")
  .attr("font-size","20");

// initialize
val01 = document.getElementById("nSex").value;
val02 = document.getElementById("nRestbp").value;
val03 = document.getElementById("nThalach").value;
val04 = document.getElementById("nCa").value;
val05 = document.getElementById("nCp").value;
val06 = document.getElementById("nSlope").value;
val07 = document.getElementById("nThal").value;
updateAll(val01,val02,val03,val04,val05,val06,val07);

// read a change in the sex input
d3.select("#nSex").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the resting blood pressure input
d3.select("#nRestbp").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the Thalium stress test Max. HR input
d3.select("#nThalach").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the ca input
d3.select("#nCa").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the cp input
d3.select("#nCp").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the slope input
d3.select("#nSlope").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// read a change in the thal input
d3.select("#nThal").on("input", function() {
  val01 = document.getElementById("nSex").value
  val02 = document.getElementById("nRestbp").value
  val03 = document.getElementById("nThalach").value
  val04 = document.getElementById("nCa").value
  val05 = document.getElementById("nCp").value
  val06 = document.getElementById("nSlope").value
  val07 = document.getElementById("nThal").value
  updateAll(val01,val02,val03,val04,val05,val06,val07);
});

// Update the heart disease probability
function updateAll(sex_val,rbp_val,thalach_val,ca_val,cp_val,slope_val,thal_val) {

  // adjust the text on the sliders
  d3.select("#nSex-value").text(sex_val);
  d3.select("#nRestbp-value").text(rbp_val);
  d3.select("#nThalach-value").text(thalach_val);
  d3.select("#nCa-value").text(ca_val);
  d3.select("#nCp-value").text(cp_val);
  d3.select("#nSlope-value").text(slope_val);
  d3.select("#nThal-value").text(thal_val);

  // Standardize the continuous features:
  var srbp_val     = (rbp_val-131.7157)/17.7478;
  var sthalach_val = (thalach_val-149.3278)/23.1211;
  var sca_val      = (ca_val-0.6722)/3.0;
  // Disentangle the categorical features:
  var cp_contr = 0.0;
  if (cp_val == 1) {
    cp_contr = -2.2318;
  } else if (cp_val == 2) {
    cp_contr = -1.2681;
  } else if (cp_val == 3) {
    cp_contr = -2.1124;
  }
  var slope_contr = 0.0;
  if (slope_val == 1) {slope_contr = -1.4726;}
  var thal_contr = 0.0;
  if(thal_val == 1) {thal_contr = 1.5009;}
  // Compute log-odds, then probability:
  var scprod = 1.4361*sex_val + 0.4415*srbp_val - 0.4431*sthalach_val + 3.7984*sca_val + cp_contr + slope_contr + thal_contr;
  var drec   = 1.0/(1.0+Math.exp(-scprod));
  var drecs  = height0*drec;
  drec       *= 100;

  holder.select("rect")
    .attr("y",y0+height0-drecs)
    .attr("height",drecs);

  holder.select("text")
    .text(function(){return parseFloat(Math.round(drec * 100) / 100).toFixed(2)+"%";});

}

</script>
</div>

</div>
</body>